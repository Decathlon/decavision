

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Preparing datasets &mdash; decavision 1.1.2 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Train models" href="train.html" />
    <link rel="prev" title="Welcome to DecaVision’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> decavision
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Functions</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Preparing datasets</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-decavision.dataset_preparation.data_augmentation">Data augmentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-decavision.dataset_preparation.generate_tfrecords">Make tfrecords</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="train.html">Train models</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Model testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utils</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="data_example.html">Build a dataset from scratch</a></li>
<li class="toctree-l1"><a class="reference internal" href="train_example.html">Train and optimize model</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">decavision</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Preparing datasets</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/data.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="preparing-datasets">
<h1>Preparing datasets<a class="headerlink" href="#preparing-datasets" title="Permalink to this headline">¶</a></h1>
<p>The following code details the functions and classes that are available to build a dataset of images and prepare it for training.</p>
<p>An example of how to use these functions can be found in <a class="reference internal" href="data_example.html"><span class="doc">Build a dataset from scratch</span></a>.</p>
<div class="section" id="module-decavision.dataset_preparation.data_augmentation">
<span id="data-augmentation"></span><h2>Data augmentation<a class="headerlink" href="#module-decavision.dataset_preparation.data_augmentation" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="decavision.dataset_preparation.data_augmentation.DataAugmentor">
<em class="property">class </em><code class="sig-prename descclassname">decavision.dataset_preparation.data_augmentation.</code><code class="sig-name descname">DataAugmentor</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path</span></em>, <em class="sig-param"><span class="n">distortion</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">flip_horizontal</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">flip_vertical</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">random_crop</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">random_erasing</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">rotate</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">resize</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">skew</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">shear</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">brightness</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">contrast</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">color</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">target_width</span><span class="o">=</span><span class="default_value">299</span></em>, <em class="sig-param"><span class="n">target_height</span><span class="o">=</span><span class="default_value">299</span></em><span class="sig-paren">)</span><a class="headerlink" href="#decavision.dataset_preparation.data_augmentation.DataAugmentor" title="Permalink to this definition">¶</a></dt>
<dd><p>Class to generate augmented images for classification purposes. Images must be located in a folder with
subfolders for each category.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> (<em>str</em>) – location of the folders containing images for each category</p></li>
<li><p><strong>option</strong> (<em>bool</em>) – use or not option during the augmentation, option can be anything between distortion,
flip_horizontal, flip_vertical, random_crop, random_erasing, rotate, resize, skew, shear, brightness,
contrast and color (options described at <a class="reference external" href="https://github.com/mdbloice/Augmentor">https://github.com/mdbloice/Augmentor</a>)</p></li>
<li><p><strong>target_width</strong> (<em>int</em>) – new width of resized images (if resized is True)</p></li>
<li><p><strong>target_height</strong> (<em>int</em>) – new height of resized images (if resized is True)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt id="decavision.dataset_preparation.data_augmentation.DataAugmentor.generate_images">
<code class="sig-name descname">generate_images</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">class_size_approximation</span></em><span class="sig-paren">)</span><a class="headerlink" href="#decavision.dataset_preparation.data_augmentation.DataAugmentor.generate_images" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate augmented images for all categories in the main folder according to the specified options. Images
are generated until the desired size is reached and they are saved in the same subfolder as the original
images.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>class_size_approximation</strong> (<em>int</em>) – approximate total number of images wanted for each category</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="decavision.dataset_preparation.data_augmentation.DataAugmentor.generate_images_single_class">
<code class="sig-name descname">generate_images_single_class</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">class_size_approximation</span></em>, <em class="sig-param"><span class="n">category</span></em><span class="sig-paren">)</span><a class="headerlink" href="#decavision.dataset_preparation.data_augmentation.DataAugmentor.generate_images_single_class" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate augmented images for a single category according to the specified options. Images are generated
until the desired size is reached and they are saved in an outputs folder at the location of the original
images.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>class_size_approximation</strong> (<em>int</em>) – approximate total number of images wanted</p></li>
<li><p><strong>category</strong> (<em>str</em>) – folder name where images to augment are located in the main folder</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-decavision.dataset_preparation.generate_tfrecords">
<span id="make-tfrecords"></span><h2>Make tfrecords<a class="headerlink" href="#module-decavision.dataset_preparation.generate_tfrecords" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="decavision.dataset_preparation.generate_tfrecords.TfrecordsGenerator">
<em class="property">class </em><code class="sig-prename descclassname">decavision.dataset_preparation.generate_tfrecords.</code><code class="sig-name descname">TfrecordsGenerator</code><a class="headerlink" href="#decavision.dataset_preparation.generate_tfrecords.TfrecordsGenerator" title="Permalink to this definition">¶</a></dt>
<dd><p>Class to transform images into tfrecords format to train neural networks. Resulting files can be
saved to google storage or locally. Can’t be used with a TPU because local files need to be read.
Strongly inspired by: <a class="reference external" href="https://medium.com/&#64;moritzkrger/speeding-up-keras-with-tfrecord-datasets-5464f9836c36">https://medium.com/&#64;moritzkrger/speeding-up-keras-with-tfrecord-datasets-5464f9836c36</a></p>
<dl class="py method">
<dt id="decavision.dataset_preparation.generate_tfrecords.TfrecordsGenerator.convert_image_folder">
<code class="sig-name descname">convert_image_folder</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">img_folder</span><span class="o">=</span><span class="default_value">'data/image_dataset/train'</span></em>, <em class="sig-param"><span class="n">output_folder</span><span class="o">=</span><span class="default_value">'data/image_dataset/train'</span></em>, <em class="sig-param"><span class="n">img_folder_new</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">shards</span><span class="o">=</span><span class="default_value">16</span></em>, <em class="sig-param"><span class="n">target_size</span><span class="o">=</span><span class="default_value">(299, 299)</span></em><span class="sig-paren">)</span><a class="headerlink" href="#decavision.dataset_preparation.generate_tfrecords.TfrecordsGenerator.convert_image_folder" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert all images in a folder (like train or val) to tfrecords. Folder must contain subfolders for each category.
Possibility to combine data from two folders to perform progressive learning. Tfrecords can be saved
locally or on google storage. A csv file containing the names of the classes is also saved.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img_folder</strong> (<em>str</em>) – location of the images</p></li>
<li><p><strong>output_folder</strong> (<em>str</em>) – folder to save the results, content of folder is deleted to save new data</p></li>
<li><p><strong>img_folder_new</strong> (<em>str</em>) – if specified, images from this folder are included in the tfrecords as
new categories for the purpose of progressive learning</p></li>
<li><p><strong>shards</strong> (<em>int</em>) – number of files to create</p></li>
<li><p><strong>target_size</strong> (<em>tuple</em><em>(</em><em>int</em><em>,</em><em>int</em><em>)</em>) – size to reshape the images</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="train.html" class="btn btn-neutral float-right" title="Train models" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to DecaVision’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Decathlon Canada

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>